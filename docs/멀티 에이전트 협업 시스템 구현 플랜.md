멀티 에이전트 협업 시스템 구현 플랜
개요
PTLPSM 프로젝트의 자동 문서화를 위한 4계층 멀티 에이전트 협업 시스템 구현 가이드
사용자 선택
설치 위치: .claude/ 폴더 (기존 구조 확장)
구현 범위: 전체 구현 (7개 에이전트 + 4개 커맨드 + 3개 스킬)
통합 방식: 기존 knowledge-base 참조만 (복사 안함)
아키텍처 개요
┌─────────────────────────────────────────────────────────────┐
│                 LAYER 1: ANALYZERS (병렬 실행)              │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │
│  │  Frontend    │ │     API      │ │   Backend    │        │
│  │  Analyzer    │ │   Analyzer   │ │   Analyzer   │ (stub) │
│  └──────┬───────┘ └──────┬───────┘ └──────┬───────┘        │
└─────────┼────────────────┼────────────────┼─────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────┐
│                 LAYER 2: SYNTHESIZER (순차 실행)            │
│         ┌───────────────────────────────────┐               │
│         │     Knowledge Synthesizer         │               │
│         │  + .claude/knowledge-base/*.yaml  │               │
│         └───────────────────┬───────────────┘               │
└─────────────────────────────┼───────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                 LAYER 3: GENERATOR (순차 실행)              │
│           ┌─────────────────────────────────┐               │
│           │      Document Generator         │               │
│           └───────────────────┬─────────────┘               │
└─────────────────────────────────────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                 LAYER 4: VALIDATOR (순차 실행)              │
│             ┌─────────────────────────────────┐             │
│             │      Quality Validator          │             │
│             └─────────────────────────────────┘             │
└─────────────────────────────────────────────────────────────┘

구현 파일 목록
1. 디렉토리 구조 (.claude/ 폴더 확장)
d:\dev\ptlpsm\.claude\
├── settings.json                      # (기존) 전역 설정
├── settings.local.json                # (기존) 로컬 설정
│
├── knowledge-base\                    # (기존) 도메인 지식
│   ├── terminology.yaml               # 용어 사전
│   ├── status-mappings.yaml           # 상태 정의
│   └── domain-rules.yaml              # 비즈니스 규칙
│
├── skills\                            # (확장) 스킬 파일
│   ├── manual-generator.skill.md      # (기존)
│   ├── user-manual-updater.skill.md   # (기존)
│   ├── code-analysis.skill.md         # (신규) 코드 분석 패턴
│   ├── document-templates.skill.md    # (신규) 문서 템플릿
│   └── validation-rules.skill.md      # (신규) 검증 규칙
│
├── agents\                            # (신규) 에이전트 정의
│   ├── analyzers\
│   │   ├── frontend-analyzer.md       # Layer 1: 프론트엔드 분석
│   │   ├── api-analyzer.md            # Layer 1: API 분석
│   │   ├── backend-analyzer.md        # Layer 1: 백엔드 분석 (stub)
│   │   └── database-analyzer.md       # Layer 1: DB 분석 (stub)
│   ├── knowledge-synthesizer.md       # Layer 2: 지식 통합
│   ├── document-generator.md          # Layer 3: 문서 생성
│   └── quality-validator.md           # Layer 4: 품질 검증
│
├── commands\                          # (신규) 커맨드 정의
│   ├── generate-manual.md             # /generate-manual
│   ├── analyze-codebase.md            # /analyze-codebase
│   ├── generate-section.md            # /generate-section
│   └── validate-docs.md               # /validate-docs
│
└── shared\                            # (신규) 에이전트 간 데이터 공유
    └── data\
        ├── .gitkeep
        └── (런타임 생성 파일들)

구현 단계
Step 1: 디렉토리 생성
# 새 디렉토리 생성
mkdir -p .claude/agents/analyzers
mkdir -p .claude/commands
mkdir -p .claude/shared/data

생성할 파일 목록 (총 14개):
구분	파일 경로	설명
에이전트	.claude/agents/analyzers/frontend-analyzer.md	프론트엔드 코드 분석
에이전트	.claude/agents/analyzers/api-analyzer.md	API 엔드포인트 분석
에이전트	.claude/agents/analyzers/backend-analyzer.md	백엔드 분석 (stub)
에이전트	.claude/agents/analyzers/database-analyzer.md	DB 분석 (stub)
에이전트	.claude/agents/knowledge-synthesizer.md	지식 통합
에이전트	.claude/agents/document-generator.md	문서 생성
에이전트	.claude/agents/quality-validator.md	품질 검증
스킬	.claude/skills/code-analysis.skill.md	코드 분석 패턴
스킬	.claude/skills/document-templates.skill.md	문서 템플릿
스킬	.claude/skills/validation-rules.skill.md	검증 규칙
커맨드	.claude/commands/generate-manual.md	전체 매뉴얼 생성
커맨드	.claude/commands/analyze-codebase.md	코드 분석만
커맨드	.claude/commands/generate-section.md	특정 섹션 생성
커맨드	.claude/commands/validate-docs.md	문서 검증
Step 2: Layer 1 - Analyzer 에이전트 생성
2.1 Frontend Analyzer
파일: .claude/agents/analyzers/frontend-analyzer.md 역할:
TypeScript 인터페이스/타입 추출
Vue 페이지 구조 분석
컴포넌트 계층 매핑
UI 텍스트 추출
분석 대상:
types/**/*.ts
pages/**/*.vue
components/**/*.vue
stores/**/*.ts
2.2 API Analyzer
파일: .claude/agents/analyzers/api-analyzer.md 역할:
엔드포인트 정의 추출
HTTP 메서드 매핑
Request/Response 타입 연결
서비스 메서드 분석
분석 대상:
services/api/endpoints/**/*.ts
services/*.service.ts
2.3 Backend Analyzer (Stub)
파일: .claude/agents/analyzers/backend-analyzer.md 상태: 스텁 (백엔드 별도 저장소) Fallback: domain-rules.yaml 사용
2.4 Database Analyzer (Stub)
파일: .claude/agents/analyzers/database-analyzer.md 상태: 스텁 (DB 직접 접근 불가) Fallback: terminology.yaml의 table 매핑 사용
Step 3: Layer 2 - Synthesizer 에이전트 생성
파일: .claude/agents/knowledge-synthesizer.md 역할:
모든 분석 결과 통합
충돌 해결 (knowledge-base 우선)
엔티티 관계 그래프 구축
비즈니스 규칙 통합
갭 분석
입력:
./shared/data/*-analysis.yaml
.claude/knowledge-base/*.yaml
출력:
./shared/data/synthesized-knowledge.yaml
Step 4: Layer 3 - Generator 에이전트 생성
파일: .claude/agents/document-generator.md 역할:
사용자 매뉴얼 생성
API 문서 생성
상태 흐름도 생성 (ASCII/Mermaid)
엔티티별 문서 생성

출력:
docs/generated/
├── USER_MANUAL.md
├── API_DOCUMENTATION.md
├── STATUS_FLOWS.md
├── ENTITY_RELATIONSHIPS.md
└── entities/
    ├── Order.md
    ├── Shipment.md
    └── ...
Step 5: Layer 4 - Validator 에이전트 생성
파일: .claude/agents/quality-validator.md 검증 항목:
완전성 (모든 엔티티 문서화)
일관성 (용어 통일)
정확성 (코드 분석 결과와 일치)
가독성 (구조, 명확성)
출력:
./shared/data/validation-report.yaml
품질 점수 및 개선 권장사항
Step 6: 오케스트레이션 커맨드 생성
6.1 /generate-manual
전체 파이프라인 실행:
Phase 1: Analysis (병렬)
├── frontend-analyzer
├── api-analyzer
├── backend-analyzer (stub)
└── database-analyzer (stub)

Phase 2: Synthesis (순차)
└── knowledge-synthesizer

Phase 3: Generation (순차)
└── document-generator

Phase 4: Validation (순차)
└── quality-validator
6.2 /analyze-codebase
분석만 실행 (문서 생성 제외)
6.3 /generate-section
특정 섹션만 생성 (entity, api, flow, rules)
6.4 /validate-docs
문서 검증 (--fix 옵션으로 자동 수정)
Step 7: Skills 생성
7.1 code-analysis Skill
코드 분석 패턴 정의:
엔티티 감지 정규식
관계 추론 규칙
상태 감지 패턴
7.2 document-templates Skill
문서 템플릿 정의:
엔티티 섹션 템플릿
상태 흐름 다이어그램 템플릿
API 문서 템플릿
7.3 validation Skill
검증 규칙 정의:
완전성 체크 규칙
일관성 체크 규칙
정확성 체크 규칙

에이전트 통신 패턴
공유 데이터 디렉토리

.claude/shared/data/
├── frontend-analysis.yaml      # Frontend Analyzer 출력
├── api-analysis.yaml           # API Analyzer 출력
├── backend-analysis.yaml       # Backend Analyzer 출력 (stub)
├── database-analysis.yaml      # Database Analyzer 출력 (stub)
├── synthesized-knowledge.yaml  # Synthesizer 출력
├── validation-report.yaml      # Validator 출력
└── generation-log.yaml         # 생성 로그

우선순위 규칙
항목	1순위	2순위	3순위
한글 용어	terminology.yaml	코드 분석	추론
상태 정의	status-mappings.yaml	enum 분석	-
비즈니스 규칙	domain-rules.yaml	코드 분석	-
엔티티 관계	domain-rules.yaml	JPA/FK 분석	타입 참조

워크플로우 정의
전체 생성 워크플로우
workflow: full_generation
phases:
  - name: initialization
    mode: sequential
    steps:
      - create shared/data directory
      - validate knowledge-base exists

  - name: analysis
    mode: parallel  # 병렬 실행
    agents: [frontend-analyzer, api-analyzer, backend-analyzer, database-analyzer]
    timeout: 300s

  - name: synthesis
    mode: sequential
    depends_on: analysis
    agents: [knowledge-synthesizer]

  - name: generation
    mode: sequential
    depends_on: synthesis
    agents: [document-generator]

  - name: validation
    mode: sequential
    depends_on: generation
    agents: [quality-validator]
증분 업데이트 워크플로우

기대 효과
자동화율 80%+: 엔티티, API, 상태 흐름 자동 문서화
일관성 보장: 용어/포맷 통일
실시간 동기화: 코드 변경 시 문서 자동 업데이트
품질 관리: 자동 검증 및 권장사항 제공
제한사항
수동 필요 (20%):
스크린샷
사용자 시나리오
복잡한 업무 설명
스텁 에이전트:
백엔드 분석 (별도 저장소)
DB 스키마 분석 (직접 접근 불가)


사용 예시

cd D:/dev/ptlpsm-docs
claude

# 데이터베이스 분석 실행
/analyze-codebase database

# 전체 문서 생성 (DB 포함)
/generate-manual
보안 고려사항
읽기 전용 권한만 부여
DDL/DROP/DELETE 비활성화
민감 정보 마스킹 (비밀번호 등)
샘플 데이터 제한 (LIMIT 10)

사용 방법

cd D:/dev/ptlpsm-docs
claude

# 데이터베이스만 분석
/analyze-codebase database

# 전체 분석 (DB 포함)
/generate-manual